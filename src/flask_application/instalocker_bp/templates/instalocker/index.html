{% extends 'base.html' %}
{% block title %}Profiles{% endblock %}
{% block main_attr %}class="l-instalocker"{% endblock %}
{% block main %}
    <form id="new-profile-form" method="post" autocomplete="off">
        {{ new_profile_form.hidden_tag() }}
    </form>
    <!-- set and delete form are made just to easily get the submit buttons.
        The data will be collected with JS and sent to the server with AJAX -->
    <form id="set-profile-form" method="post" autocomplete="off"></form>
    <form id="delete-profile-form" method="post" autocomplete="off"></form>

    <section id="l-section-wrapper"> 
        <section id="l-left-section">
            <!-- Start/Stop checkbox button -->
            <label for="instalocker-start-stop" class="btn primary-btn curtain-btn checkbox-btn thin-bs-border {{ 'is-checked' if instalocker_active else '' }}">
                <input id="instalocker-start-stop" type="checkbox" {{ 'checked' if instalocker_active else '' }}>
                <span class="label-content">{{ 'Deactivate' if instalocker_active else 'Activate' }}</span>
                <span class="curtain"></span>
            </label>
            
            <!-- Profile items. Has the name and game-mode information. Has the select form submit button and the delete form submit button -->
            <!-- TODO: add shadow when there is content overflowing -->
            <div class="small-item-container">
                {% for profile in profiles %}
                    <div class="small-item" data-profile-id="{{ profile.name }}" data-profile-type="item">
                        <!-- Select profile button. Submits the select form to the server -->
                        <button class="select-btn btn curtain-btn neutral-curtain thin-bs-border neutral-thin-bs-border {{ 'is-checked' if selected_profile.name == profile.name else '' }}" type="submit" form="set-profile-form">
                            <div class="name">{{ profile.name }}</div>
                            <div class="game-mode">{{ profile.game_mode.name.replace('_', ' ') }}</div>
                            <span class="curtain"></span>
                        </button>
                        <!-- Delete button. Submits the delete form to the server -->
                        <button class="btn shadow-btn" type="submit" form="delete-profile-form">
                            <i class="fa-regular fa-trash-can"></i>
                        </button>
                    </div>
                {% endfor %}
            </div>

            <!-- New profile name/game-mode input field -->
            <div id="new-profile-basic-input-container" class="small-item is-fake-hidden">
                <!-- Name and game-mode input fields -->
                {{ new_profile_form.name(class="select-btn thin-bs-border neutral-thin-bs-border", form="new-profile-form", placeholder='New profile name') }}
                {{ new_profile_form.game_mode(class="thin-bs-border neutral-thin-bs-border", form="new-profile-form", aria_label="label for the select") }}
                <!-- Actual create profile button. Submits the create form to the server -->
                <button class="btn shadow-btn neutral-shadow" type="submit" form="new-profile-form">
                    <i class="fa-solid fa-plus"></i>
                </button>
            </div>

            <!-- Create profile checkbox button. Toggle the create profile inputs -->
            <label for="create-profile-checkbox" class="btn secondary-btn curtain-btn neutral-curtain checkbox-btn thin-bs-border neutral-thin-bs-border">
                <input id="create-profile-checkbox" type="checkbox">
                <span class="label-content">Create new profile</span>
                <span class="curtain"></span>
            </label>
        </section>

        <section id="l-right-section">
            <!-- New profile map-agent input fields -->
            <div>
                {% for field in new_profile_form if field.name not in ['name', 'game_mode', 'csrf_token'] %}
                    <div>
                        <span>{{ field.label }}</span>
                        <span>{{ field(form="new-profile-form") }}</span>
                    </div>
                {% endfor %}
            </div>

            <!-- Existent profiles information -->
            {% for profile in profiles %}
                <div data-profile-id="{{ profile.name }}" data-profile-type="description">
                    <div>
                        {% for map, agent in profile.map_agent.items() %}
                            <div>
                                <span>{{ map }}</span>
                                <span>{{ agent }}</span>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endfor %}
        </section>
    </section>
{% endblock %}
